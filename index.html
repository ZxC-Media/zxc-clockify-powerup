<!DOCTYPE html>
<html>
<head>
  <title>ZxC Clockify Power-Up Connector</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
  <script>
    // =====================================================================
    //                            CONFIGURATION
    // =====================================================================
    const ZXC_BLOCK_START = '--- ZxC Sync ---';
    const isTimerRunning = (desc) => desc && desc.includes(ZXC_BLOCK_START);

    // =====================================================================
    //                 Trello Power-Up Initialization
    // =====================================================================
    TrelloPowerUp.initialize({
      // --- CARD BADGES CAPABILITY ---
      'card-badges': function(t) {
        return t.card('desc').then(card => {
          const blockText = card.desc.split(ZXC_BLOCK_START)[1] || '';
          const startTimeMatch = blockText.match(/TimestampStarted:\s*(.+)/);
          if (!startTimeMatch) return [];

          const startTime = new Date(startTimeMatch[1]);
          const now = new Date();
          const elapsedMs = now - startTime;

          const hours = String(Math.floor(elapsedMs / 3600000)).padStart(2,'0');
          const minutes = String(Math.floor((elapsedMs % 3600000) / 60000)).padStart(2,'0');
          const seconds = String(Math.floor((elapsedMs % 60000) / 1000)).padStart(2,'0');

          return [{
            text: `⏱️ ${hours}:${minutes}:${seconds}`,
            color: 'green',
            refresh: 1
          }];
        });
      }

      // --- CARD BACK SECTION CAPABILITY ---
      'card-back-section': function(t, options) {
        return {
          title: 'Clockify Time Summary',
          icon: 'https://clockify.me/assets/images/clockify-logo-white-email.png',
          content: {
            type: 'iframe',
            url: t.signUrl('./section.html'), // Points to our dashboard file
            height: 180 // Adjusted height for the new UI
          }
        };
      }
    });
  </script>
</body>
</html>

